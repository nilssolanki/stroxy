(function(){'use strict';const h=obj=>Object.assign(Object.create(null),obj),i=1,j=-1,k=h({addEventListener:{callbackIndex:1,type:i},removeEventListener:{callbackIndex:1,type:j},setTimeout:{callbackIndex:0,type:i},clearTimeout:{callbackIndex:0,type:j},setInterval:{callbackIndex:0,type:i},clearInterval:{callbackIndex:0,type:j},on:{callbackIndex:1,type:i},off:{callbackIndex:1,type:j},removeListener:{callbackIndex:1,type:j}}),l=name=>!!k[name],m=name=>k[name],n=(name,config)=>!k[name]?!!(k[name]=config):!1,o=h({add:'addEventListener',remove:'removeEventListener'}),p=alias=>o[alias]?o[alias]:alias,q=(alias,name)=>!o[alias]?!!(o[alias]=name):!1,r=/^\[object/,s=obj=>r.test(Object.prototype.toString.call(obj)),t=fn=>typeof fn=='function',u=number=>number===Number(number),v=obj=>typeof NodeList!='undefined'?NodeList.prototype.isPrototypeOf(obj):!1,w=obj=>v(obj)||Array.isArray(obj)||t(obj[Symbol.iterator]),y=Symbol('stroxy-stream');function a(B,C){C=C.slice();const D=C.indexOf(B);C.splice(D,1);return C}function b(B,C){B=B.slice();return B.map(D=>{D._value=D.pipes.reduce((val,fn)=>fn(val,C),C);return D})}function c(B){B.valueListeners.forEach(({listener:C,instance:D})=>{C(D._value)})}function d(B){return B.parent?B.parent:B}const z={[y]:!0,instances:[],valueListeners:[],pipe(B){if(!this.parent){const C=Object.assign(Object.create(this),{_value:this._value,parent:this,pipes:[B],valueOf:null});this.instances.push(C);return C}this.pipes.push(B);return this},onValue(B){const C=d(this);C.valueListeners.push({listener:B,instance:this})},offValue(B){const C=d(this);C.valueListeners=a(B,C.valueListeners)},remove(B){if(this.parent){console.warn('Cannot remove child stream from another child stream.Did you want to remove it from the parent stream?');return!1}this.instances=a(B,this.instances);this.valueListeners=this.valueListeners.filter(({instance:listenerInstance})=>listenerInstance!==B)},event(){if(this.eventFunction){return this.eventFunction}return this.eventFunction=B=>{if(this.parent){console.warn(`Child streams can't have their own event listeners.`);return!1}this._value=B;this.instances=b(this.instances,B);c(this)}}};function e(){return Object.assign(Object.create(z),{instances:[],valueListeners:[]})}const A=Symbol('stroxy');function f(B,C){const D=w(B),E=D?B[0][C]:B[C];if(!t(E)){return B[C]}return(...F)=>{let G,H;const{type:I,callbackIndex:J}=m(C);if(u(J)){if(I===i){G=e()}else{[G]=F.splice(J,1);if(G.parent){G.parent.remove(G);return}}const K=G.event().hasOwnProperty('valueOf')?G.event().valueOf():G.event();F.splice(J,null,K)}if(D){Array.from(B).forEach(K=>{Reflect.apply(K[C],K,F)})}else{H=Reflect.apply(B[C],B,F);if(G&&H!=null){G.event().valueOf=x=>H}}return G}}function g(B,C){return new Proxy(C?B[C]:B,{get(D,E){const F=D[E],G=p(E);if(l(G)){return f(D,G)}if(E===A){return!0}if(s(F)){return g(D,E)}return F},apply(D,E,F){const G=Reflect.apply(D,B,F);if(s(G)){return g(G)}return G}})}g=Object.assign(g,{addStreamable:n,addAlias:q,ADD:i,REMOVE:j});if(typeof module=='object'&&typeof module.exports=='object'){module.exports=exports.default=g}else if(typeof window=='object'){window.stroxy=g}})();